<!-- Dashboard -->
<% include header %>
<main>
	<div id="tabDashboard" class="row">
	  <div class="col s12">
	    <ul class="tabs">
	    	<li class="tab col s2"><a class="active" href="#dashboard">DashBoard</a></li>
	    	<li class="tab col s2"><a href="#logs">Logs</a></li>
	      <li class="tab col s2"><a href="#stats">Stats</a></li>
	    </ul>
	  </div>
	  <div id="dashboard" class="container">
	  	<div class="col s12">
	  		<% if (user.firstname != null && user.lastname != null) { %>
	  			<h3 class="left">Bienvenue <%- user.fullName()%></h3>
	  		<% } else { %>
		  		<h3 class="left">Bienvenue</h3>
		  	<% } %>
				<p class="right"><a class="btn-floating btn-medium waves-effect waves-light"><i class="material-icons" onclick="openCreateDevice()">add</i></a></p>
		  	<table class="dashboard">
	        <thead>
	          <tr>
	              <th data-field="id">#</th>
	              <th data-field="name">Device Name</th>
	              <th data-field="state">State</th>
	              <th data-field="state">Actions</th>
	              <th data-field="state">Connected</th>
	          </tr>
	        </thead>
	        <tbody>
	        </tbody>
				</table>
	  	</div>
	  </div>
		<div id="logs" class="container">
		  <div class="col s12">
		    <table class="logs">
		      <thead>
		        <tr>
		            <th data-field="userId">User</th>
		            <th data-field="deviceName">Device Name</th>
		            <th data-field="state">State</th>
		            <th data-field="description">Description</th>
		            <th data-field="updated">Update date</th>
		        </tr>
		      </thead>
		      <tbody>
		      </tbody>
		    </table>
		  </div>
		</div>
	</div>

	<!-- Modal Object Info -->
<div id="modal1" class="modal">
	<div class="modal-content">
		<h4>Information</h4>
		<div class="row">
		 <form class="col s12" action="/device/update" method="POST">
			 <div class="row">
				 <div class="input-field col s12">
					 <input placeholder="Placeholder" id="deviceName" name="name" type="text" class="validate">
					 <label for="deviceName">Device Name</label>
				 </div>
			 </div>
			 <div class="modal-footer">
				<input type="hidden" name="id" id="deviceId">
				<div class="col s12">
					<div class="col s4">
						<button style="width:100%" type="button" onclick="deleteDevice($(this).attr('meta'))" id="deleteButton" class="waves-effect waves-light red btn">Delete</button>
					</div>
					<div class="col s4">
						<button style="width:100%" type="submit"class="waves-effect waves-light btn">Save</button>
					</div>
					<div class="col s4">
						<button style="width:100%" type="button" onclick="closeModal()" class="waves-effect waves-light btn">Close</button>
					</div>
				</div>
		 	 </div>
		 </form>
	 </div>
	</div>
</div>

<!-- Modal adding object -->
<div id="modal2" class="modal">
	<div class="modal-content">
		<h4>Ajouter un objet</h4>
		<div class="row">
		 <form class="col s12" action="/device/create" method="POST">
			 <div class="row">
				 <div class="input-field col s12">
					 <input placeholder="Placeholder" id="deviceName" name="name" type="text" class="validate">
					 <label for="deviceName">Device Name</label>
				 </div>
			 </div>
			 <div class="modal-footer">
				<input type="hidden" name="id" id="deviceId">
				<div class="col s12">
					<div class="col s4">
						<button style="width:100%" type="submit"class="waves-effect waves-light btn">Save</button>
					</div>
					<div class="col s4">
						<button style="width:100%" type="button" onclick="closeModal()" class="waves-effect waves-light btn">Close</button>
					</div>
				</div>
		 	 </div>
		 </form>
	 </div>
	</div>
</div>

<script type="text/javascript">

	function openEditDevice(deviceId, deviceName) {
		$('#deviceId').val(deviceId);
		$('#deleteButton').attr('meta', deviceId);
		$('#deviceName').val(deviceName);
		$('#modal1').openModal();
	}

	function openCreateDevice() {
		$('#modal2').openModal();
	}

	function deleteDevice(e) {
		$.ajax({
			url: 'device/delete',
			type: 'POST',
			data: {
				 'id' : e
			 }
    }).done(this.closeModal());
  }

	function closeModal() {
		$('#modal1').closeModal();
		$('#modal2').closeModal();
	}

</script>

</main>
<% include footer %>
